<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <link href="assets/css/bootstrap.min.css" rel="stylesheet"/>
    <link rel="stylesheet" href="css/style.css"/>
    <link href="assets/css/codemirror.css" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/colorbox.css">
    <!--图片相册11122244441-->
    <link rel="stylesheet" href="assets/css/ace.min.css"/>

    <link rel="stylesheet" href="font/css/font-awesome.min.css"/>
    <!--[if lte IE 8]>
    <link rel="stylesheet" href="assets/css/ace-ie.min.css"/>
    <![endif]-->
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="assets/js/jquery.colorbox-min.js"></script>
    <script src="assets/js/typeahead-bs2.min.js"></script>
    <script src="assets/js/jquery.dataTables.min.js"></script>
    <script src="assets/js/jquery.dataTables.bootstrap.js"></script>
    <script src="assets/layer/layer.js" type="text/javascript"></script>
    <script src="js/cupload.js"></script>
    <script src="js/myRoute.js"></script>

    <!-- 图片插件 -->
    <link rel="stylesheet" type="text/css" href="Sortable/FraUpload.css">
    <!-- <script src="Sortable/jquery.min.js?v=2.1.4"></script> -->
    <!-- 图片排序 -->
    <script src="Sortable/Sortable.js"></script>
    <script type="text/javascript" src="Sortable/MD5.js"></script>
    <script type="text/javascript" src="Sortable/FraUpload.js"></script>

    <title>列表</title>
    <style type="text/css">
        .string { color: green; }
         .number { color: darkorange; }
         .boolean { color: blue; }
         .null { color: magenta; }
         .key { color: red; }
         body{
            padding: 1rem;
         }
         pre{
            background-color: #f7f7f9;
            border: 1px solid #e1e1e8;
            padding: 5px 10px;
            margin: 0;
            border-radius: 8px;
            min-height: 20px;
         }
         xmp{
            margin: 0;
            padding: 0;
         }
         #upload_duixiang{
            display: inline-block;
            margin-bottom: 8px;
            margin-left: 10px;
            color: #fff;
            background-color: #337ab7;
            border-color: #2e6da4;
            padding: 5px 10px;
            font-size: 12px;
            line-height: 1.5;
            border-radius: 3px;
            cursor: pointer;
         }
    </style>
</head>

<body>
<div class="page-content clearfix">
    <div class="sort_adsadd_style">
        <div class="border clearfix">
       <span class="l_f">
        <a href="javascript:;" id="ads_add" title="添加屏保" class="btn btn-warning Order_form"><i class="fa fa-plus"></i> 添加屏保</a>
        <a href="javascript:;" id="all_del" class="btn btn-danger"><i class="fa fa-trash"></i> 批量删除</a>
           <!-- <a href="javascript:ovid()" onClick="javascript :history.back(-1);" class="btn btn-info"><i class="fa fa-reply"></i> 返回上一步</a> -->
       </span>
            <span class="r_f">共：<b><span id="pageCount">234</span></b>条记录</span>
        </div>
        <!--列表样式-->
        <div class="sort_Ads_list">
            <table class="table table-striped table-bordered table-hover" id="sample-table">
                <thead>
                <tr>
                    <th width="25"><label><input type="checkbox" class="ace"><span class="lbl"></span></label></th>
                    <th width="50px">ID</th>
                    <th width="100">分类</th>
                    <th width="240px">图片</th>
                    <th width="150px">尺寸（大小）</th>
                    <th width="200px">标题</th>
                    <th width="200">描述</th>
                    <th width="70">状态</th>
                    <th width="300">操作</th>
                </tr>
                </thead>
                <tbody id="content">

                <tr>
                    <td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>
                    <td>1</td>
                    <td>图片</td>
                    <td><span class="ad_img"><a href="#" data-rel="colorbox" data-title="广告图"><img src="products/ad.jpg"
                                                                                                   width="100%"
                                                                                                   height="100%"/></a></span>
                    </td>
                    <td>1890x1080</td>
                    <td>标题1</td>
                    <td>描述1</td>
                    <td class="td-status"><span class="label label-success radius">显示</span></td>
                    <td class="td-manage">
                        <a title="停用" href="javascript:;" onClick="member_stop(this,'10001')"
                           class="btn btn-xs btn-success"><i class="fa fa-check  bigger-120"></i></a>
                        <!-- <a title="编辑" href="javascript:;"  onclick="member_edit('编辑','member-add.html','4','','510')" class="btn btn-xs btn-info" ><i class="fa fa-edit bigger-120"></i></a> -->
                        <a title="删除" href="javascript:;" onclick="member_del(this,'1')" class="btn btn-xs btn-warning"><i
                                class="fa fa-trash  bigger-120"></i></a>
                        <a title="上移" href="javascript:;" onclick="member_up(this,'1')" class="btn btn-xs btn-green"><i
                                class="fa fa-arrow-up  bigger-120"></i></a>
                        <a title="下移" href="javascript:;" onclick="member_down(this,'1')" class="btn btn-xs btn-lan"><i
                                class="fa fa-arrow-down  bigger-120"></i></a>
                    </td>
                </tr>

                <tr>
                    <td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>
                    <td>2</td>
                    <td>图片</td>
                    <td><span class="ad_img"><a href="#" data-rel="colorbox" data-title="广告图"><img
                            src="products/ad1.jpg" width="100%" height="100%"/></a></span></td>
                    <td>1890x1080</td>
                    <td>标题2</td>
                    <td>描述2</td>
                    <td class="td-status"><span class="label label-success radius">显示</span></td>
                    <td class="td-manage">
                        <a title="停用" href="javascript:;" onClick="member_stop(this,'10001')"
                           class="btn btn-xs btn-success"><i class="fa fa-check  bigger-120"></i></a>
                        <!-- <a title="编辑" href="javascript:;"  onclick="member_edit('编辑','member-add.html','4','','510')" class="btn btn-xs btn-info" ><i class="fa fa-edit bigger-120"></i></a> -->
                        <a title="删除" href="javascript:;" onclick="member_del(this,'1')" class="btn btn-xs btn-warning"><i
                                class="fa fa-trash  bigger-120"></i></a>
                        <a title="上移" href="javascript:;" onclick="member_up(this,'1')" class="btn btn-xs btn-green"><i
                                class="fa fa-arrow-up  bigger-120"></i></a>
                        <a title="下移" href="javascript:;" onclick="member_down(this,'1')" class="btn btn-xs btn-lan"><i
                                class="fa fa-arrow-down  bigger-120"></i></a>
                    </td>
                </tr>
                <tr>
                    <td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>
                    <td>2</td>
                    <td>图片</td>
                    <td><span class="ad_img"><a href="#" data-rel="colorbox" data-title="广告图"><img
                            src="products/p_42.jpg" width="100%" height="100%"/></a></span></td>
                    <td>1890x1080</td>
                    <td>标题3</td>
                    <td>描述3</td>
                    <td class="td-status"><span class="label label-success radius">显示</span></td>
                    <td class="td-manage">
                        <a title="停用" href="javascript:;" onClick="member_stop(this,'10001')"
                           class="btn btn-xs btn-success"><i class="fa fa-check  bigger-120"></i></a>
                        <!-- <a title="编辑" href="javascript:;"  onclick="member_edit('编辑','member-add.html','4','','510')" class="btn btn-xs btn-info" ><i class="fa fa-edit bigger-120"></i></a> -->
                        <a title="删除" href="javascript:;" onclick="member_del(this,'1')" class="btn btn-xs btn-warning"><i
                                class="fa fa-trash  bigger-120"></i></a>
                        <a title="上移" href="javascript:;" onclick="member_up(this,'1')" class="btn btn-xs btn-green"><i
                                class="fa fa-arrow-up  bigger-120"></i></a>
                        <a title="下移" href="javascript:;" onclick="member_down(this,'1')" class="btn btn-xs btn-lan"><i
                                class="fa fa-arrow-down  bigger-120"></i></a>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

    </div>
</div>
<!--添加广告样式-->
<div id="add_ads_style" style="display:none; top:0px;">
    <div class="add_adverts">
        <ul>
            <li style="height:32px">
                <label class="label_name">分类</label>
                <span class="cont_style">
                <select class="form-control" id="form-field-select-1">
                  <option value="AL">图片</option>
                  <option value="AK">视频</option>
                </select></span>
            </li>
            <li style="height:32px">
                <label class="label_name">标题</label>
                <span class="cont_style">
                  <input name="标题" type="text" id="form-field-1" placeholder="标题" class="col-xs-10 col-sm-5" style="width:300px">
                </span>
            </li>
            <li style="height:32px">
                <label class="label_name">描述</label>
                <span class="cont_style">
                  <input name="描述" type="text" id="form-field-1" placeholder="描述" class="col-xs-10 col-sm-5" style="width:500px">
                </span>
            </li>
            <li>
                <label class="label_name">图片</label>
                <div class="cont_style">
                  <!-- <div id="cupload-create" style="margin-left:10px;"></div>
                  <p style="color:red;margin-left:10px;">仅支持.jpg;.png;.jpeg格式的图片</p> -->
                  <form enctype="multipart/form-data">
                      <input type="hidden" id="imagepath" name="">  <!-- 保存的图片id 用于表单提交 -->
                      <span id="upload_duixiang">上传</span><!-- 上传按钮 -->
                      <div class="show"></div> <!-- 输出图片 -->
                      <!-- <pre id="geoJsonTxt"></pre> -->
                       <!-- 输出文件的json数据 -->
                  </form>

                </div>
            </li>
        </ul>
    </div>
</div>
</body>
</html>
<script>
    /*******添加广告*********/
    $('#ads_add').on('click', function () {
        layer.open({
            type: 1,
            title: '添加屏保',
            maxmin: true,
            shadeClose: false, //点击遮罩关闭层
            area: ['800px', ''],
            content: $('#add_ads_style'),
            btn: ['提交', '取消'],
            yes: function (index, layero) {
                var num = 0;
                var str = "";
                $(".add_adverts input[type$='text']").each(function (n) {
                    if ($(this).val() == "") {

                        layer.alert(str += "" + $(this).attr("name") + "不能为空！\r\n", {
                            title: '提示框',
                            icon: 0,
                        });
                        num++;
                        return false;
                    }
                });
                if (num > 0) {
                    return false;
                } else {
                    layer.alert('添加成功！', {
                        title: '提示框',
                        icon: 1,
                    });
                    layer.close(index);
                }
            }
        });
    })

    /*批量删除*/
    $('#all_del').on('click', function () {
        layer.confirm('确认要批量删除吗？', function (index) {
            $(obj).parents("tr").remove();
            layer.msg('已删除!', {icon: 1, time: 1000});
        });
    })

</script>

<script>
    //默认可能上传3张
    // var cuploadCreate = new Cupload({
    //     ele: '#cupload-create',
    //     num: 3,
    // });
    //图片上传插件可选参数

    // 商品图片上传
    a = $("#upload_duixiang").FraUpload({
        view        : ".show",      // 视图输出位置
        url         : "upload.php", // 上传接口
        fetch       : "img",   // 视图现在只支持img
        debug       : false,    // 是否开启调试模式
        /* 外部获得的回调接口 */
        onLoad: function(e){                    // 选择文件的回调方法
            console.log("外部: 初始化完成...");
        },
        breforePort: function (e) {         // 发送前触发
            console.log("文件发送之前触发");
        },
        successPort: function (e) {         // 发送成功触发
            console.log("文件发送成功");
            onload_image()
        },
        errorPort: function (e) {       // 发送失败触发
            console.log("文件发送失败");
            onload_image()
        },
        deletePost: function(e){    // 删除文件触发
            console.log("删除文件");
            console.log(e);
            alert('删除了'+e.filename)
            onload_image()
        },
        sort: function(e){      // 排序触发
            console.log("排序");
            onload_image()
        },
    });

    // 获取图片上传信息
    function onload_image(){
        var res = a.FraUpload.show()
        var ids = [];
        for(let k in res){
            this_val = res[k]
            if(!empty(res[k]['is_upload']) && !empty(res[k]['ajax'])){
                ajax_value = res[k]['ajax'];
                ids.push(ajax_value.data.id)
            }
        }
        $("#imagepath").val(ids);
        $('#geoJsonTxt').html(JsonFormat(res));
    }

    // 将类库返回的json打印到pre中
    function JsonFormat(json) {
        if (typeof json != 'string') {
            json = JSON.stringify(json, undefined, 2);
        }
            json = json.replace(/&/g, '&').replace(/</g, '<').replace(/>/g, '>');
            return json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, function (match) {
                 var cls = 'number';
                    if (/^"/.test(match)) {
                            if (/:$/.test(match)) {
                                cls = 'key';
                            } else {
                                cls = 'string';
                            }
                    } else if (/true|false/.test(match)) {
                        cls = 'boolean';
                    } else if (/null/.test(match)) {
                        cls = 'null';
                    }
                    return '<span class="' + cls + '">' + match + '</span>';
             });
    }
    /**
     * 判断变量是否为空
     */
    function empty(value) {
        if(value=="" || value==undefined || value==null || value==false || value==[] || value=={}){
            return true;
        }else{
            return false;
        }
    }




    /*用户-停用*/
    function member_stop(obj, id) {
        layer.confirm('确认要停用吗？', function (index) {
            $(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" class="btn btn-xs " onClick="member_start(this,id)" href="javascript:;" title="启用"><i class="fa fa-close bigger-120"></i></a>');
            $(obj).parents("tr").find(".td-status").html('<span class="label label-defaunt radius">已停用</span>');
            $(obj).remove();
            changeStatus(id)
            layer.msg('已停用!', {icon: 5, time: 1000});
        });
    }

    /*用户-启用*/
    function member_start(obj, id) {
        layer.confirm('确认要启用吗？', function (index) {
            $(obj).parents("tr").find(".td-manage").prepend('<a style="text-decoration:none" class="btn btn-xs btn-success" onClick="member_stop(this,id)" href="javascript:;" title="停用"><i class="fa fa-check  bigger-120"></i></a>');
            $(obj).parents("tr").find(".td-status").html('<span class="label label-success radius">已启用</span>');
            $(obj).remove();
            changeStatus(id);
            layer.msg('已启用!', {icon: 6, time: 1000});
        });
    }

    //修改bannel 显示隐藏状态
    function changeStatus(id)
    {
        var data = {};
        data.id = id;
        data.token = localStorage.token;
        $.ajax({
            type: 'get',
            dataType: 'json',
            url: bannelUpdateStatus,
            data: data,
            success: function (res) {
                if (res.code != 200) {
                    layer.msg(res.message, {icon: 6, time: 1000});
                }
            }
        });
    }

    /*产品-编辑*/
    function member_edit(title, url, id, w, h) {
        layer_show(title, url, w, h);
    }

    /*产品-删除*/
    function member_del(obj, id) {
        layer.confirm('确认要删除吗？', function (index) {
            $(obj).parents("tr").remove();
            layer.msg('已删除!', {icon: 1, time: 1000});
        });
    }

    /*产品-上移*/
    function member_up(obj, id) {
        exchangeSort(id,1)
    }

    /*产品-下移*/
    function member_down(obj, id) {
        exchangeSort(id,2)
    }

    /**
     *   产品上移或者下移
     */
    function exchangeSort(id,direction)
    {
        //分页获取数据
        var data = {};
        data.token = localStorage.token;
        data.id = id;
        data.direction = direction;
        $.ajax({
            type: 'get',
            dataType: 'json',
            url: bannelExchangePosition,
            data: data,
            success: function (res) {
                //成功后刷新这个页面
                initPage();
            }
        });
    }


    function layer_show(title, url, w, h) {
        if (title == null || title == '') {
            title = false;
        }
        ;
        if (url == null || url == '') {
            url = "404.html";
        }
        ;
        if (w == null || w == '') {
            w = 800;
        }
        ;
        if (h == null || h == '') {
            h = ($(window).height() - 50);
        }
        ;
        layer.open({
            type: 2,
            area: [w + 'px', h + 'px'],
            fix: false, //不固定
            maxmin: true,
            shade: 0.4,
            title: title,
            content: url
        });
    }


    initPage();

    //初始化这一页的数据
    function initPage() {
        //分页获取数据
        var data = {};
        data.token = localStorage.token;
        data.pageNo = 1;
        data.pageSize = 10;
        data.bannelType = bannelPage_pingbao;
        $.ajax({
            type: 'get',
            dataType: 'json',
            url: bannelPage,
            data: data,
            success: function (res) {
                var content = initContent(res.data);
                $('#content').html(content);

                //
                var oTable1 = $('#sample-table').dataTable( {
                "aaSorting": [[ 1, "desc" ]],//默认第几个排序
                "bStateSave": true,//状态保存
                "searching" : false,
                "aoColumnDefs": [
                  //{"bVisible": false, "aTargets": [ 3 ]} //控制列的隐藏显示
                  {"orderable":false,"aTargets":[0,2,3,4,5,6]}// 制定列不参与排序
                ] } );

                //选择所有
                $('table th input:checkbox').on('click' , function(){
                  var that = this;
                  $(this).closest('table').find('tr > td:first-child input:checkbox')
                  .each(function(){
                    this.checked = that.checked;
                    $(this).closest('tr').toggleClass('selected');
                  });

                });
                //选择单个值
                $('#content > tr > td:first-child input:checkbox').on('click' , function(){
                  var that = this;
                  var curHtml = $(this).parent('label').parent('td').siblings()[0];
                  console.log(this);
                  $(curHtml).each(function(){
                    var val = $(this).text();
                    console.log(val);
                    });
                });
            }
        });
    }

    //动态加载数据内容
    function initContent(data) {
        var status_btn=new Array();
        status_btn[1]="btn-success";
        status_btn[2]="";
        var status_fa=new Array();
        status_fa[1]="fa-check";
        status_fa[2]="fa-close";
        var status_label=new Array();
        status_label[1]="label-success";
        status_label[2]="label-defaunt";
        var status_click=new Array();
        status_click[1]="member_stop";
        status_click[2]="member_start";
        //定义bannel 状态
        var BANNEL_STATUS=new Array();
        BANNEL_STATUS[1]="已启用";
        BANNEL_STATUS[2]="已停用";

        var content = "";
        for (var i in data) {
            content += '<tr>\n' +
                '                <td><label><input type="checkbox" class="ace"><span class="lbl"></span></label></td>\n' +
                '                <td>' + data[i].id + '</td>\n' +
                '                <td>' + BANNEL_TYPE[data[i].bannel_type] + '</td>\n' +
                '                <td><span class="ad_img"><a href="#" data-rel="colorbox" data-title="广告图"><img src="' + data[i].image_url + '"  width="100%" height="100%"/></a></span></td>\n' +
                '                <td>' + data[i].image_height + 'x' + data[i].image_width + '</td>\n' +
                '                <td>' + data[i].title + '</td>\n' +
                '                <td>' + data[i].content + '</td>\n' +
                '                <td class="td-status"><span class="label '+status_label[data[i].status]+' radius">' + BANNEL_STATUS[data[i].status] + '</span></td>\n' +
                '                <td class="td-manage">\n' +
                '                <a title="停用" href="javascript:;" onClick="'+status_click[data[i].status]+'(this,' + data[i].id + ')"   class="btn btn-xs '+status_btn[data[i].status]+'"><i class="fa '+status_fa[data[i].status]+' bigger-120"></i></a>\n' +
                '                <a title="删除" href="javascript:;"  onClick="member_del(this,' + data[i].id + ')"  class="btn btn-xs btn-warning" ><i class="fa fa-trash  bigger-120"></i></a>\n' +
                '                <a title="上移" href="javascript:;"  onClick="member_up(this,' + data[i].id + ')"  class="btn btn-xs btn-green" ><i class="fa fa-arrow-up  bigger-120"></i></a>\n' +
                '                <a title="下移" href="javascript:;"  onClick="member_down(this,' + data[i].id + ')"  class="btn btn-xs btn-lan" ><i class="fa fa-arrow-down  bigger-120"></i></a>\n' +
                '                </td>\n' +
                '</tr>\n';
        }
        return content;
    }
</script>
